[gd_scene load_steps=4 format=2]

[ext_resource path="res://OurGuy.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends KinematicBody2D

export var _HorizontalVelocity := 60.0
export var _GravityVelocity := 120
export var _JumpForce := 150
export var _JumpingDuration := 0.3
export var _DiagonalFactor := 1.3
export var _Accel := 0.1
export var _Deaccel := 0.3
export var _SprintVelocity := 130.0

var _CurrSpeed := Vector2(0, 0)
var _GravAcceleration := 0.25
var _JumpDeaccel := 0.05
var _IsJumping := false
var _GoingLeft := false

func getFinalXSpeed() -> void:
  var inputVelocity := _HorizontalVelocity
  
  if Input.is_action_pressed(\"ui_shift\"):
    inputVelocity = _SprintVelocity
  
  if Input.is_action_pressed(\"ui_right\") || Input.is_action_pressed(\"ui_left\"):
    var inputStrength = (
      Input.get_action_strength(\"ui_right\") - Input.get_action_strength(\"ui_left\")
    )
    _CurrSpeed.x = lerp(_CurrSpeed.x, inputVelocity * inputStrength, _Accel)
  else:
    _CurrSpeed.x = lerp(_CurrSpeed.x, 0, _Deaccel)

func getFinalYSpeed() -> void:
  if self.is_on_floor():
    _CurrSpeed.y = 1.0
  else:
    if _IsJumping:
      _CurrSpeed.y = lerp(_CurrSpeed.y, 0, _JumpDeaccel)
    else:
      _CurrSpeed.y = lerp(_CurrSpeed.y, _GravityVelocity, _GravAcceleration)

func _ready():
  $JumpTimer.one_shot = true

func calcSpriteSide() -> void:
  if _CurrSpeed.x > 0 && _GoingLeft:
    _GoingLeft = false
    $Sprite.scale.x *= -1
  elif _CurrSpeed.x < 0 && !_GoingLeft:
    _GoingLeft = true
    $Sprite.scale.x *= -1

func _process(delta):
  var floorAngle : float
  
  self.getFinalXSpeed()
  
  if Input.is_action_just_pressed(\"ui_accept\") && self.is_on_floor():
    _IsJumping = true
    _CurrSpeed.y = -_JumpForce
    $JumpTimer.start(_JumpingDuration)
  elif Input.is_action_just_released(\"ui_accept\"):
    $JumpTimer.stop()
    _IsJumping = false
  else:
    self.getFinalYSpeed()
  
  if _IsJumping:
    self.move_and_slide(_CurrSpeed, Vector2.UP, true)
  else:
    self.move_and_slide_with_snap(_CurrSpeed, Vector2.DOWN, Vector2.UP, true)
    
  calcSpriteSide()

func _on_JumpTimer_timeout():
  _IsJumping = false

func _on_Coin_pickedUp():
  print(\"Peguei!!\")
"

[sub_resource type="RectangleShape2D" id=2]
extents = Vector2( 5.04, 14.9329 )

[node name="OurGuy" type="KinematicBody2D"]
script = SubResource( 1 )

[node name="Sprite" type="Sprite" parent="."]
position = Vector2( 0, -16 )
texture = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2( 0, -15 )
shape = SubResource( 2 )

[node name="JumpTimer" type="Timer" parent="."]

[node name="Camera2D" type="Camera2D" parent="."]
position = Vector2( 0, -15 )
current = true
[connection signal="timeout" from="JumpTimer" to="." method="_on_JumpTimer_timeout"]
