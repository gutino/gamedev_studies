[gd_scene load_steps=4 format=2]

[ext_resource path="res://OurGuy.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends KinematicBody2D

export var _HorizontalVelocity := 80.0
export var _GravityVelocity := 120
export var _JumpForce := 260
export var _JumpingDuration := 0.25
export var _diagonalFactor := 1.3

var _IsJumping := false
var _GoingLeft := false

func _ready():
	$JumpTimer.one_shot = true

func changeSide():
	$Sprite.scale.x *= -1
	
func fixBoundary():
	var windowSize = get_viewport().size
	
	if self.position.y > windowSize.y:
		self.position.y = 0
	if self.position.x > windowSize.x:
		self.position.x = 0
	
	if self.position.x < $Sprite.get_rect().size.x*2:
		self.position.x = $Sprite.get_rect().size.x*2

func _process(delta):
	var finalVelocity : Vector2 = Vector2(0,_GravityVelocity)
	var floorAngle : float
	
	if Input.is_action_pressed(\"ui_right\"):
		finalVelocity.x += _HorizontalVelocity
		if _GoingLeft:
			changeSide()
			_GoingLeft = false
	elif Input.is_action_pressed(\"ui_left\"):
		finalVelocity.x -= _HorizontalVelocity
		if not _GoingLeft:
			changeSide()
			_GoingLeft = true
	
	if Input.is_action_just_pressed(\"ui_accept\") && self.is_on_floor():
		_IsJumping = true
		$JumpTimer.start(_JumpingDuration)
	
	if _IsJumping:
		finalVelocity.y -= _JumpForce
		self.move_and_slide(finalVelocity, Vector2.UP, true)
	else:
		if is_on_floor():
			floorAngle = get_floor_normal().angle_to(Vector2.UP)
			var absFloorAngle = abs(floorAngle)
			
			if floorAngle > 0 and not _GoingLeft:
				finalVelocity.x *= (1 + absFloorAngle)*_diagonalFactor
			elif floorAngle > 0 and _GoingLeft:
				finalVelocity.x *= (1 - absFloorAngle)*_diagonalFactor
			elif floorAngle < 0 and _GoingLeft:
				finalVelocity.x *= (1 + absFloorAngle)*_diagonalFactor
			elif floorAngle < 0 and not _GoingLeft:
				finalVelocity.x *= (1 - absFloorAngle)*_diagonalFactor
		
		self.move_and_slide_with_snap(finalVelocity, Vector2.DOWN*20, Vector2.UP, true)
	
	fixBoundary()


func _on_JumpTimer_timeout():
	_IsJumping = false

func _on_Coin_pickedUp():
	print(\"Peguei!!\")
"

[sub_resource type="RectangleShape2D" id=2]
extents = Vector2( 5.04, 14.9329 )

[node name="OurGuy" type="KinematicBody2D"]
script = SubResource( 1 )

[node name="Sprite" type="Sprite" parent="."]
position = Vector2( 0, -16 )
texture = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2( 0, -15 )
shape = SubResource( 2 )

[node name="JumpTimer" type="Timer" parent="."]

[node name="Camera2D" type="Camera2D" parent="."]
position = Vector2( 0, -15 )
current = true
[connection signal="timeout" from="JumpTimer" to="." method="_on_JumpTimer_timeout"]
